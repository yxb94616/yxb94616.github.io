{"pageProps":{"postData":{"id":"pnpm-monorepo","contentHtml":"<p><code>pnpm</code> æ˜¯ä»€ä¹ˆï¼š</p>\n<blockquote>\n<p>Fast, disk space efficient package manager.</p>\n<p>é€Ÿåº¦å¿«ã€èŠ‚çœç£ç›˜ç©ºé—´çš„è½¯ä»¶åŒ…ç®¡ç†å™¨</p>\n</blockquote>\n<p><code>monorepo</code> æ˜¯ä»€ä¹ˆï¼š</p>\n<blockquote>\n<p>A monorepo is a single repository containing multiple distinct projects, with well-defined relationships.</p>\n<p>monorepo æ˜¯åŒ…å«å¤šä¸ªä¸åŒé¡¹ç›®çš„å•ä¸ªå­˜å‚¨åº“ï¼Œå…·æœ‰æ˜ç¡®å®šä¹‰çš„å…³ç³»ã€‚</p>\n</blockquote>\n<p>ä¸ºä»€ä¹ˆéœ€è¦ <code>monorepo</code> ï¼š</p>\n<blockquote>\n<p>å½“ä½ éœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªæŠ€æœ¯æ ˆç±»ä¼¼çš„é¡¹ç›®ï¼Œè€Œè¿™äº›é¡¹ç›®ä¹‹é—´äº’ç›¸ä¾èµ–çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>monorepo</code> ä¼šæœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚ï¼š</p>\n</blockquote>\n<ul>\n<li>é¡¹ç›®åŸºç¡€è®¾æ–½å¯ä»¥ç»Ÿä¸€ç®¡ç†ï¼Œæ¯”å¦‚ <code>eslint</code>ã€<code>prettier</code>ã€<code>tsconfig</code>ç­‰</li>\n<li>é¡¹ç›®ä¸­æŠ½ç¦»çš„å…¬å…±ä»£ç åº“ï¼Œåœ¨äº’ç›¸ä¾èµ–çš„æ—¶å€™å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œä¾èµ–ç®¡ç†å’Œè°ƒè¯•ï¼Œæ¯”å¦‚ <code>utils</code>ã€<code>api</code>ã€<code>ui</code>ç­‰</li>\n<li>ä»¥åŠä½¿ç”¨ <code>npm</code>ã€<code>yarn</code>ã€<code>pnpm</code> ç­‰åŒ…ç®¡ç†å™¨å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œç¬¬ä¸‰æ–¹ä¾èµ–çš„ç»Ÿä¸€ç®¡ç†ï¼Œè¾¾åˆ°èŠ‚çœå®‰è£…ç©ºé—´ï¼Œæå‡å®‰è£…é€Ÿåº¦ç­‰ç›®çš„</li>\n</ul>\n<p><code>æœ¬æ–‡ç« åªæ˜¯è®°å½•é¡¹ç›®æ­å»ºè¿‡ç¨‹ï¼Œå¹¶ä¸åšæ¦‚å¿µå’ŒåŸç†çš„è§£é‡Š</code></p>\n<p>å¦‚æœä½ å¯¹æœ¬æ–‡ç« æ„Ÿå…´è¶£ï¼Œåˆå¯¹æ ‡é¢˜ä¸­çš„ <code>pnpm</code> å’Œ <code>monorepo</code> éƒ½ä¸äº†è§£ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹åœ°å€äº†è§£ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼š</p>\n<ul>\n<li><a href=\"https://pnpm.io/zh/\">pnpm</a></li>\n<li><a href=\"https://monorepo.tools\">monorepo</a></li>\n</ul>\n<h2>å‡†å¤‡å·¥ä½œ</h2>\n<p>å®‰è£… <code>pnpm</code> , <code>node</code> ç‰ˆæœ¬æœ€å¥½æ˜¯åœ¨ <code>16v</code> åŠä»¥ä¸Š</p>\n<pre><code>npm install -g pnpm\n</code></pre>\n<p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹</p>\n<pre><code>mkdir monorepoo-project\ncd monorepo-project\n</code></pre>\n<p>åœ¨é¡¹ç›®ä¸­æ–°å»ºè‹¥å¹²æ–‡ä»¶å¤¹ï¼Œæ­å»ºé¡¹ç›®ç»“æ„ï¼š</p>\n<pre><code>.\nâ”œâ”€apps  # åº”ç”¨ä»£ç ç›®å½•\nâ”‚  â”œâ”€admin  # ç®¡ç†å¹³å°åº”ç”¨\nâ”‚  â””â”€portal # é—¨æˆ·ç½‘ç«™åº”ç”¨\nâ””â”€packages # å…¬å…±åº“\n    â”œâ”€api # apiç®¡ç†\n    â”œâ”€tsconfig # tsconfigé…ç½®\n    â”œâ”€ui # å…¬å…±ç»„ä»¶\n    â””â”€utils # å…¬å…±æ–¹æ³•\n</code></pre>\n<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶ <code>pnpm-workspace.yaml</code>ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre><code># pnpm-workspace.yaml\n\npackages:\n  - \"packages/*\"\n  - \"apps/*\"\n</code></pre>\n<p>ç„¶åè¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œåœ¨ä¸‹é¢æ ¹ç›®å½•åˆå§‹åŒ–ç”Ÿæˆ <code>package.json</code></p>\n<pre><code>pnpm init\n</code></pre>\n<p>ä¿®æ”¹ç”Ÿæˆçš„ <code>package.json</code></p>\n<pre><code>// package.json\n{\n  \"name\": \"monorepo-project\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {},\n  \"devDependencies\": {}\n}\n</code></pre>\n<p>åŸºç¡€çš„é¡¹ç›®ç›®å½•ç»“æ„ä»¥åŠå‡†å¤‡å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œç¼–ç å·¥ä½œï¼Œå»ä½“éªŒä¸€ä¸‹ <code>monorepo</code></p>\n<h2>ç¼–å†™ demo ä»£ç </h2>\n<h3>ç¼–å†™ <code>utils</code> demo</h3>\n<p>åœ¨ <code>packages/utils</code> åˆå§‹åŒ–ä¸€ä¸‹åº”ç”¨</p>\n<pre><code>cd ./packages/utils\npnpm init\n</code></pre>\n<p>ä¿®æ”¹ <code>packages/utils</code> ä¸‹ç”Ÿæˆçš„ <code>package.json</code></p>\n<pre><code>// packages/utils/package.json\n{\n  \"name\": \"utils\",\n  \"version\": \"0.0.0\",\n  \"main\": \"./index.ts\",\n  \"module\": \"./index.ts\"\n}\n</code></pre>\n<p>ç„¶åå†æ–°å»ºä¸€ä¸ªæ–‡ä»¶ <code>index.ts</code>ï¼Œå†™å…¥ä¸€ä¸ªæµ‹è¯•æ–¹æ³•</p>\n<pre><code>function hello(msg = \"world\") {\n  return `hello ${msg}!`;\n}\n\nexport { hello };\n</code></pre>\n<h3>ç¼–å†™ <code>portal</code> demo</h3>\n<p>è¿™é‡Œä½¿ç”¨ <code>vite</code> + <code>react</code> æŠ€æœ¯æ ˆï¼Œåœ¨ <code>apps/portal</code> é‡Œåˆå§‹åŒ–ä¸€ä¸‹åº”ç”¨</p>\n<p>åœ¨ <code>apps/portal</code> åˆå§‹åŒ–ä¸€ä¸‹åº”ç”¨</p>\n<pre><code>cd ./apps/portal\npnpm create vite\n</code></pre>\n<p>å¦‚æœåœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ– <code>vite</code> åº”ç”¨ï¼Œå¯ä»¥åœ¨ <code>Project name</code> çš„æ—¶å€™è¾“å…¥ <code>.</code> ï¼Œè¿™æ ·å°±ä»¥å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹ä½œä¸ºåº”ç”¨ç›®å½•</p>\n<p>å°† <code>apps/portal</code> ç”Ÿæˆçš„ <code>package.json</code> é‡Œçš„ä¾èµ–é…ç½®å‰ªåˆ‡åˆ°æ ¹ç›®å½•ä¸‹çš„ <code>package.json</code></p>\n<pre><code>// apps/portal/package.json\n{\n  \"name\": \"portal\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"tsc &#x26;&#x26; vite build\",\n    \"preview\": \"vite preview\"\n  }\n}\n</code></pre>\n<pre><code>// package.json\n{\n  \"name\": \"monorepo-project\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {},\n  \"dependencies\": {\n    \"react\": \"^18.2.0\",\n    \"react-dom\": \"^18.2.0\"\n  },\n  \"devDependencies\": {\n    \"@types/react\": \"^18.0.15\",\n    \"@types/react-dom\": \"^18.0.6\",\n    \"@vitejs/plugin-react\": \"^2.0.0\",\n    \"typescript\": \"^4.6.4\",\n    \"vite\": \"^3.0.0\"\n  }\n}\n</code></pre>\n<p>ç„¶åå®‰è£…ä¸€ä¸‹ä¾èµ–ï¼Œè¿™é‡Œå®‰è£…åœ¨æ ¹ç›®å½•çš„ä¾èµ–æ˜¯æ•´ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨çš„</p>\n<pre><code>pnpm install\n</code></pre>\n<blockquote>\n<p>å¦‚æœè¦å®‰è£…ä¾èµ–åˆ°æ ¹ç›®å½•ï¼Œä½¿ç”¨ <code>-w</code> å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p>\n</blockquote>\n<pre><code>pnpm add axios -w\n</code></pre>\n<blockquote>\n<p>å¦‚æœè¦åœ¨æŒ‡å®šçš„åº”ç”¨ä¸­å®‰è£…ä¾èµ–ï¼Œä½¿ç”¨ <code>--filter</code> å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p>\n</blockquote>\n<pre><code>pnpm --filter api add axios\n</code></pre>\n<blockquote>\n<p><code>--filter</code> ä¹Ÿå¯ä»¥æŒ‡å®šåœ¨å…·ä½“åº”ç”¨ä¸‹æ‰§è¡Œè„šæœ¬å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>\n</blockquote>\n<p>å¯åŠ¨ <code>portal</code> åº”ç”¨</p>\n<pre><code>pnpm --filter portal dev\n</code></pre>\n<p>è®¿é—®è¾“å‡ºçš„ <code>Local Server</code> åœ°å€ <a href=\"http://127.0.0.1:5173\">http://127.0.0.1:5173</a>ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/833c3a406f294cf98add34f2df1c608c~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658217760878.jpg\"></p>\n<p>æ¥ä¸‹æ¥æŠŠåˆšæ‰å†™çš„ <code>utils</code> æ·»åŠ åˆ° <code>portal</code> ä¸­</p>\n<pre><code>// apps/portal/package.json\n{\n  \"name\": \"portal\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"tsc &#x26;&#x26; vite build\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"utils\": \"workspace:*\"\n  }\n}\n</code></pre>\n<p>è¿™é‡Œçš„ <code>\"utils\": \"workspace:*\"</code> æ˜¯æ‰‹åŠ¨æ·»åŠ çš„ï¼Œå› ä¸º <code>npm</code> ä¸Šæ˜¯å­˜åœ¨ <code>utils</code> è¿™ä¸ªåº“çš„ï¼Œ\nç‰ˆæœ¬å·å†™æˆ <code>workspace:*</code>ï¼Œ<code>workspace</code> ä»£è¡¨çš„æ˜¯å·¥ä½œç©ºé—´ï¼Œè¿™ä¸ªåœ¨ <a href=\"https://pnpm.io/zh/\">pnpm</a> é‡Œæœ‰ä»‹ç»ï¼Œ\n<code>*</code> æ˜¯ä»£è¡¨ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬ï¼Œä¸è¿‡åœ¨æœ¬é¡¹ç›®ä¸­ä¹Ÿä¸å­˜åœ¨ä¾èµ–åº“ç‰ˆæœ¬å˜æ›´é—®é¢˜ã€‚</p>\n<p>ç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä¾èµ–å®‰è£…</p>\n<pre><code>pnpm install\n</code></pre>\n<p>åœ¨ <code>portal</code> ä¸­å¼•å…¥ <code>utils</code>ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬ç¼–å†™çš„æµ‹è¯•æ–¹æ³•</p>\n<pre><code>// apps/portal/src/App.tsx\n+ import { hello } from \"utils\";\n+ &#x3C;h1>Vite + React + {hello()}&#x3C;/h1>\n</code></pre>\n<p>ç„¶åé‡æ–°å¯åŠ¨ä¸€ä¸‹ <code>portal</code> åº”ç”¨</p>\n<pre><code>pnpm --filter portal dev\n</code></pre>\n<p>å†è®¿é—®è¾“å‡ºçš„ <code>Local Server</code> åœ°å€ <a href=\"http://127.0.0.1:5173\">http://127.0.0.1:5173</a>ï¼Œå¦‚ä¸‹å›¾\n<img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a02de05d5934c3ea7d9380dcfad91c2~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658217790226.jpg\"></p>\n<h3>ç¼–å†™ <code>admin</code> demo</h3>\n<p>æŒ‰ç…§ <code>portal</code> åº”ç”¨çš„åˆ›å»ºæ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸‹ <code>admin</code> åº”ç”¨ï¼Œä¹Ÿå¼•å…¥ <code>utils</code> è¿›è¡Œæµ‹è¯•ï¼Œ ç„¶åå¯åŠ¨ <code>admin</code>\n<img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae9eeed5d0eb4ad78b33bddc5f93b6bf~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658218443080.jpg\"></p>\n<p>åœ¨ <code>admin</code> ä¸­å¼•å…¥ <code>utils</code>ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬ç¼–å†™çš„æµ‹è¯•æ–¹æ³•</p>\n<pre><code>// apps/admin/src/App.tsx\n+ import { hello } from \"utils\";\n+ &#x3C;h1>Vite + React + {hello(\"monorepo\")}&#x3C;/h1>\n</code></pre>\n<p>ç„¶åæ”¹ä¸€ä¸‹ <code>utils</code> æä¾›çš„æ–¹æ³• <code>hello</code> è¾“å‡ºï¼Œå†çœ‹ä¸€ä¸‹ <code>portal</code> å’Œ <code>admin</code></p>\n<pre><code>// packages/utils/index.ts\n+ return `hello ${msg}! ä»£ç ä¸æ­¢ï¼Œæ˜é‡‘ä¸åœã€‚`;\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ° <code>portal</code> å’Œ <code>admin</code> ä¸éœ€è¦é‡å¯ï¼Œ<code>utils</code> çš„ä¿®æ”¹å°±å·²ç»ç”Ÿæ•ˆäº†ï¼Œè€Œä¸” <code>utils</code> ä¹Ÿä¸éœ€è¦æ‰“åŒ…å°±å¯ä»¥å¼•å…¥ä½¿ç”¨</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25c65666621548b388d93802522658ae~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658218890077.jpg\">\n<img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00609c15ed224f47bac578832aac4b72~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658218890065.jpg\"></p>\n<h2>åº”ç”¨æ‰“åŒ…</h2>\n<p>ç„¶åæˆ‘ä»¬å†æµ‹è¯•ä¸€ä¸‹ <code>build</code>ï¼Œç„¶åä½¿ç”¨ <code>vite</code> æä¾›çš„ <code>preview</code> é¢„è§ˆä¸€ä¸‹æ‰“åŒ…åº”ç”¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</p>\n<pre><code># æ‰“åŒ…\npnpm --filter portal build\n# é¢„è§ˆ\npnpm --filter portal preview\n</code></pre>\n<p>é€šè¿‡ <code>preview</code> å‘½ä»¤è¾“å‡ºçš„ <code>Local Server</code> åœ°å€è¿›è¡Œè®¿é—®ï¼Œæ­£å¸¸ä¼šçœ‹åˆ°</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/595f9147c2474cc29940a31b2af92421~tplv-k3u1fbpfcp-watermark.image?\" alt=\"1658219084249.jpg\"></p>\n<p>æœ€åï¼Œå†æŒ‰ç…§ä¸Šé¢çš„æµç¨‹ï¼Œç¼–å†™ä¸€ä¸‹ <code>ui</code> å’Œ <code>api</code> çš„ demo ä»£ç ï¼Œ\nå¹¶åº”ç”¨åˆ° <code>portal</code> å’Œ <code>admin</code> ä¸­å»ã€‚è¿™éƒ¨åˆ†ä»£ç æˆ‘æ”¾åˆ°äº†githubï¼Œ\nå¯ä»¥å‚è€ƒè¿™ä¸ª <a href=\"https://github.com/yxb94616/monorepo-project/pull/1\">PR</a></p>\n<pre><code>ç¬¬ä¸€æ¬¡åœ¨æ˜é‡‘å‘è¡¨æ–‡ç« ï¼Œå¦‚æœæœ‰ä»€ä¹ˆåœ°æ–¹å†™å¾—ä¸å¯¹çš„ï¼Œæˆ–è€…ä¸æ¸…æ¥šçš„ï¼Œè¯·å¤šå¤šæŒ‡æ•™~ğŸ‘Œ\n</code></pre>\n","title":"Use pnpm to build a monorepo project","date":"2022-07-20"}},"__N_SSG":true}